set nocompatible
let mapleader = ","

source ~/.vim/bundles.vim
source ~/.vim/keymaps.vim

" Vim options
filetype plugin indent on
syntax on
set encoding=utf-8
set number
set relativenumber
set ignorecase
set smartcase
set infercase
set hlsearch
set incsearch
set smartindent
set tabstop=2
set softtabstop=2
set shiftwidth=2
set expandtab
set backspace=indent,eol,start
set wildmenu
set wildmode=full
set mouse=a
set nowrap
set shiftround
set fillchars+=stlnc:-
set laststatus=2
set nobackup
set noswapfile
set undodir=~/.vim/tmp/undo//
set undofile
set undolevels=1000 "maximum number of changes that can be undone
set undoreload=10000 "maximum number lines to save for undo on a buffer reload
set dictionary=/usr/share/dict/words
set foldmethod=syntax
set foldlevel=3
colorscheme neverland

" CSApprox, for emulating gvim colors on the terminal
if !has('gui_running') && exists(':CSApprox')
  CSApprox
endif

if &term =~ '^\(xterm\|screen\)$' && $COLORTERM == 'gnome-terminal'
  set t_Co=256
endif

runtime macros/matchit.vim " match the opening/closign html tag when pressing '%'

augroup vimrcEx
  autocmd!
  " When editing a file, always jump to the last known cursor position.
  " Don't do it for commit messages, when the position is invalid, or when
  " inside an event handler (happens when dropping a file on gvim).
  autocmd BufReadPost *
        \ if &ft != 'gitcommit' && line("'\"") > 0 && line("'\"") <= line("$") |
        \ exe "normal g`\"" |
        \ endif
  " Set syntax highlighting for specific file types
  autocmd BufRead,BufNewFile *.md set filetype=markdown
  " Enable spellchecking for Markdown
  autocmd FileType markdown setlocal spell
  " Automatically wrap at 80 characters for Markdown
  autocmd BufRead,BufNewFile *.md setlocal textwidth=80
  " Automatically wrap at 72 characters and spell check git commit messages
  autocmd FileType gitcommit setlocal textwidth=72
  autocmd FileType gitcommit setlocal spell
  " Allow stylesheets to autocomplete hyphenated words
  autocmd FileType css,scss,sass setlocal iskeyword+=-
  " Remove any trailing whitespace before saving
  autocmd BufWrite * :FixWhitespace
  " Automatically closes Fugitive.vim buffers when leaving them
  autocmd BufReadPost fugitive://* set bufhidden=delete
  " Resize splits when the window is resized
  autocmd VimResized * :wincmd =
augroup END

" SuperTab
let g:SuperTabDefaultCompletionType = 'context'

augroup SuperTab
  autocmd!
  autocmd FileType *
    \ if &omnifunc != '' |
    \   call SuperTabChain(&omnifunc, "<c-p>") |
    \ endif
augroup end

augroup Neomake
  autocmd!
  autocmd BufRead * Neomake
  autocmd BufWritePost * Neomake
augroup end

let g:neomake_make_modified = 1
let g:neomake_verbose = 0
let g:neomake_haml_haml_lint_maker = {
  \ 'exe': 'haml-lint',
  \ 'errorformat': '%f:%l [%t] %m'
  \ }
let g:neomake_haml_enabled_makers = ['haml_lint']

" CtrlP
let g:ctrlp_max_files = 100000
let g:ctrlp_working_path_mode = 0

" The Silver Searcher
if executable('ag')
  " Use ag over grep
  set grepprg=ag\ --nogroup\ --nocolor\ --smart-case

  " Use ag in CtrlP for listing files. Lightning fast and respects .gitignore
  let g:ctrlp_user_command = 'ag %s -l --nocolor -g ""'

  " ag is fast enough that CtrlP doesn't need to cache
  let g:ctrlp_use_caching = 0
endif

" Vim AirLine
let g:airline_powerline_fonts = 1
let g:airline#extensions#tabline#enabled = 1

" Rspec
let g:rspec_command = "SlimuxShellRun bundle exec spring rspec {spec}"

" Netrw
let g:netrw_localrmdir='rm -r'

" Vim instant markdown
let g:instant_markdown_autostart = 0
